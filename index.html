<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘å€‘çš„åœ‹éš›å‰µæ„å¸‚é›†ï¼šå­¸ç¿’è­·ç…§</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* --- å…¨å±€æ¨£å¼ (ç¶­æŒä¸è®Š) --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f4f8; color: #333; line-height: 1.6; margin: 0; padding: 20px;
        }
        .passport-container {
            max-width: 900px; margin: 20px auto; background-color: #fff; border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); overflow: hidden; border: 1px solid #ddd;
        }
        .passport-header {
            background-color: #4a69bd; color: white; padding: 20px 30px; text-align: center;
        }
        .passport-header h1 { margin: 0; font-size: 2em; letter-spacing: 2px; }
        .passport-header p { margin: 5px 0 0; opacity: 0.9; }
        .tab-nav { display: flex; background-color: #e2e8f0; border-bottom: 1px solid #cbd5e0; }
        .tab-button {
            flex: 1; padding: 15px 10px; border: none; background-color: transparent;
            cursor: pointer; font-size: 1em; font-weight: 600; color: #4a5568;
            transition: background-color 0.3s, color 0.3s; border-bottom: 3px solid transparent;
        }
        .tab-button:hover { background-color: #cbd5e0; }
        .tab-button.active { color: #4a69bd; border-bottom: 3px solid #4a69bd; background-color: #fff; }
        .tab-content { padding: 30px; }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .task-card {
            background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px;
            padding: 20px; margin-bottom: 25px;
        }
        .task-card h2 { margin-top: 0; color: #1e3a8a; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; }
        label { display: flex; align-items: center; font-weight: 600; margin-bottom: 8px; }
        label svg { width: 1.3em; height: 1.3em; margin-right: 10px; fill: #4a69bd; flex-shrink: 0; }
        input[type="text"], textarea {
            width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 6px;
            font-size: 1em; box-sizing: border-box; margin-bottom: 15px; background-color: #fff;
        }
        textarea { resize: vertical; min-height: 100px; }
        input[type="text"]:focus, textarea:focus { outline: none; border-color: #4a69bd; box-shadow: 0 0 0 2px rgba(74, 105, 189, 0.2); }
        .grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .action-button {
            display: block; width: 100%; padding: 15px; background-color: #3c5aa6;
            color: white; border: none; border-radius: 8px; font-size: 1.1em;
            font-weight: bold; cursor: pointer; text-align: center; margin-top: 30px;
            transition: background-color 0.3s;
        }
        .action-button:hover { background-color: #2d4373; }
        .action-button:disabled { background-color: #a0aec0; cursor: not-allowed; }

        /* æ­¥é©Ÿ 2: æ–°å¢ PDF åŒ¯å‡ºå°ˆç”¨æ¨£å¼ */
        .pdf-export-mode .tab-nav, 
        .pdf-export-mode .action-button {
            display: none !important; /* åœ¨åŒ¯å‡ºæ™‚éš±è—æ‰€æœ‰å°è¦½åˆ—å’ŒæŒ‰éˆ• */
        }
        .pdf-export-mode .tab-pane {
            display: none !important; /* é è¨­éš±è—æ‰€æœ‰é ç±¤å…§å®¹ */
        }
        
        @media (max-width: 600px) {
            body { padding: 10px; }
            .tab-nav { flex-direction: column; }
            .tab-button { border-bottom: 1px solid #cbd5e0; }
            .tab-button.active { border-bottom: 3px solid #4a69bd; }
            .grid-container { grid-template-columns: 1fr; }
            .passport-header h1 { font-size: 1.5em; }
            .tab-content { padding: 20px; }
        }
    </style>
</head>
<body>

    <div class="passport-container" id="passport-content">
        <header class="passport-header">
            <h1>æˆ‘å€‘çš„åœ‹éš›å‰µæ„å¸‚é›†</h1>
            <p>å­¸ç¿’è­·ç…§ Learning Passport</p>
        </header>

        <nav class="tab-nav">
            <button class="tab-button active" data-tab="tab1">â‘  è­·ç…§é¦–é </button>
            <button class="tab-button" data-tab="tab2">â‘¡ æ¢ç´¢è‡ºç£å¯¶è—</button>
            <button class="tab-button" data-tab="tab3">â‘¢ è¨­è¨ˆä¸–ç•Œæ”¤ä½</button>
            <button class="tab-button" data-tab="tab4">â‘£ å¸‚é›†æ—¥åæ€</button>
        </nav>

        <main class="tab-content">
            <!-- Tab 1: è­·ç…§é¦–é  -->
            <div id="tab1" class="tab-pane active">
                <div class="task-card">
                    <h2>è­·ç…§æŒæœ‰äººè³‡è¨Š / Passport Holder Information</h2>
                    <div class="grid-container">
                        <div>
                            <label for="student-name">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                                å§“å / Name
                            </label>
                            <input type="text" id="student-name" placeholder="è«‹è¼¸å…¥2-4å€‹ç¹é«”ä¸­æ–‡å§“å">
                        </div>
                        <div>
                            <label for="group-members">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                                å°çµ„æˆå“¡ / Group Members
                            </label>
                            <input type="text" id="group-members" placeholder="è«‹è¼¸å…¥æ‰€æœ‰çµ„å“¡çš„å§“å">
                        </div>
                    </div>
                </div>
                 <div class="task-card">
                    <h2>æ—…ç¨‹ä»»å‹™èªªæ˜ / Journey Tasks Guide</h2>
                    <p>æ­¡è¿ä¾†åˆ°ã€Œæˆ‘å€‘çš„åœ‹éš›å‰µæ„å¸‚é›†ã€ï¼...</p>
                 </div>
                 <!-- æ­¥é©Ÿ 1: ä¿®æ”¹HTMLï¼ŒåŠ å…¥ç¨ç«‹çš„ä¸‹è¼‰æŒ‰éˆ• -->
                 <button class="action-button download-pdf-btn" data-target="tab1" data-filename-prefix="è­·ç…§é¦–é ">ğŸ“„ ä¸‹è¼‰ã€Œè­·ç…§é¦–é ã€ç‚º PDF</button>
            </div>

            <!-- Tab 2: æ¢ç´¢è‡ºç£å¯¶è— -->
            <div id="tab2" class="tab-pane">
                <div class="task-card">
                    <h2>Step 1ï¼šè‡ºç£å¥½ç‰©è…¦åŠ›æ¿€ç›ª</h2>
                    <textarea id="taiwan-ideas" placeholder="è«‹ç›¡æƒ…å¯«ä¸‹æ‰€æœ‰æƒ³åˆ°çš„è‡ºç£ç‰¹è‰²ç‰©å“..."></textarea>
                </div>
                <div class="task-card">
                    <h2>Step 2ï¼šé¸å®šæˆ‘å€‘çš„ã€Œè‡ºç£ä¹‹å…‰ã€</h2>
                    <input type="text" id="selected-item" placeholder="è«‹å¡«å¯«æœ€çµ‚é¸å®šçš„ç”¢å“åç¨±">
                    <textarea id="item-story" placeholder="è«‹åˆ©ç”¨å¹³æ¿æˆ–åœ–æ›¸ï¼ŒæŸ¥è©¢ä¸¦è¨˜éŒ„ä¸‹å®ƒçš„æ•…äº‹..."></textarea>
                </div>
                <button class="action-button download-pdf-btn" data-target="tab2" data-filename-prefix="æ¢ç´¢å°ç£å¯¶è—">ğŸ“„ ä¸‹è¼‰ã€Œæ¢ç´¢å°ç£å¯¶è—ã€ç‚º PDF</button>
            </div>

            <!-- Tab 3: è¨­è¨ˆä¸–ç•Œæ”¤ä½ -->
            <div id="tab3" class="tab-pane">
                <!-- å…§å®¹çœç•¥ä»¥ä¿æŒç°¡æ½” -->
                <div class="task-card">...</div>
                <div class="task-card">...</div>
                <div class="task-card">...</div>
                <button class="action-button download-pdf-btn" data-target="tab3" data-filename-prefix="è¨­è¨ˆä¸–ç•Œæ”¤ä½">ğŸ“„ ä¸‹è¼‰ã€Œè¨­è¨ˆä¸–ç•Œæ”¤ä½ã€ç‚º PDF</button>
            </div>
            
            <!-- Tab 4: å¸‚é›†æ—¥åæ€ -->
            <div id="tab4" class="tab-pane">
                <!-- å…§å®¹çœç•¥ä»¥ä¿æŒç°¡æ½” -->
                <div class="task-card">...</div>
                <div class="task-card">...</div>
                <div class="task-card">...</div>
                <button class="action-button download-pdf-btn" data-target="tab4" data-filename-prefix="å¸‚é›†æ—¥åæ€">ğŸ“„ ä¸‹è¼‰ã€Œå¸‚é›†æ—¥åæ€ã€ç‚º PDF</button>
            </div>
        </main>
        
        <!-- ç§»é™¤æœ€å¤–å±¤çš„çµ±ä¸€æŒ‰éˆ• -->
    </div>

    <script>
        // --- é ç±¤åˆ‡æ›åŠŸèƒ½ (ç¶­æŒä¸è®Š) ---
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabPanes = document.querySelectorAll('.tab-pane');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabPanes.forEach(pane => pane.classList.remove('active'));
                button.classList.add('active');
                const tabId = button.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // --- æ­¥é©Ÿ 3: å…¨é¢é‡æ§‹ PDF ç”Ÿæˆèˆ‡ä¸‹è¼‰åŠŸèƒ½ ---
        const passportContainer = document.getElementById('passport-content');

        /**
         * é©—è­‰å§“åæ˜¯å¦ç‚º 2-4 å€‹ç¹é«”ä¸­æ–‡å­—
         * @param {string} name - è¦é©—è­‰çš„å§“å
         * @returns {boolean} - æ˜¯å¦é€šéé©—è­‰
         */
        function validateName(name) {
            // é€™å€‹æ­£è¦è¡¨ç¤ºå¼ ^[\u4e00-\u9fa5]{2,4}$ çš„æ„æ€æ˜¯ï¼š
            // ^ : å­—ä¸²çš„é–‹é ­
            // [\u4e00-\u9fa5] : ä»»ä½•ä¸€å€‹åœ¨ Unicode CJK çµ±ä¸€æ¼¢å­—ç¯„åœå…§çš„å­—å…ƒ
            // {2,4} : å‰é¢çš„è¦å‰‡å¿…é ˆé€£çºŒå‡ºç¾ 2 åˆ° 4 æ¬¡
            // $ : å­—ä¸²çš„çµå°¾
            const regex = /^[\u4e00-\u9fa5]{2,4}$/;
            return regex.test(name);
        }

        /**
         * è™•ç†å–®ä¸€é ç±¤çš„ PDF ä¸‹è¼‰è«‹æ±‚
         * @param {HTMLButtonElement} buttonElement - è¢«é»æ“Šçš„æŒ‰éˆ•å…ƒç´ 
         */
        async function handlePdfDownload(buttonElement) {
            const studentNameInput = document.getElementById('student-name');
            const studentName = studentNameInput.value.trim();

            // 1. åŸ·è¡Œå§“åé©—è­‰
            if (!validateName(studentName)) {
                alert('å§“åè¼¸å…¥éŒ¯èª¤ï¼\nè«‹åœ¨ã€Œè­·ç…§é¦–é ã€çš„å§“åæ¬„ä½ä¸­ï¼Œè¼¸å…¥ 2 è‡³ 4 å€‹ç¹é«”ä¸­æ–‡å­—ã€‚');
                studentNameInput.focus(); // è®“ä½¿ç”¨è€…æ–¹ä¾¿ä¿®æ”¹
                return; // ä¸­æ–·åŸ·è¡Œ
            }

            // å¾æŒ‰éˆ•çš„ data-* å±¬æ€§ç²å–è³‡è¨Š
            const targetPaneId = buttonElement.dataset.target;
            const fileNamePrefix = buttonElement.dataset.filenamePrefix;
            const targetPane = document.getElementById(targetPaneId);
            
            if (!targetPane) return;

            // æš«æ™‚ç¦ç”¨æŒ‰éˆ•
            buttonElement.disabled = true;
            buttonElement.innerText = 'PDF ç”¢ç”Ÿä¸­...';

            // 2. æº–å‚™ PDF å…§å®¹
            // åŠ ä¸Šå°ˆç”¨ class ä¾†éš±è—ä¸å¿…è¦çš„å…ƒç´ 
            passportContainer.classList.add('pdf-export-mode');
            // å¼·åˆ¶é¡¯ç¤ºæˆ‘å€‘è¦åŒ¯å‡ºçš„é‚£ä¸€é 
            targetPane.style.display = 'block';

            // 3. è¨­å®š PDF æª”åèˆ‡é¸é …
            const fileName = `${fileNamePrefix}_${studentName}.pdf`;
            const options = {
                margin:       [0.5, 0.5, 0.5, 0.5],
                filename:     fileName,
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, useCORS: true },
                jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
            };

            try {
                // 4. ç”Ÿæˆä¸¦ä¸‹è¼‰ PDF
                // æ ¸å¿ƒï¼šhtml2pdf åªæœƒæ•æ‰ `passportContainer` å…§ç›®å‰å¯è¦‹çš„å…§å®¹ä¾†ç”ŸæˆPDF
                await html2pdf().from(passportContainer).set(options).save();
            } catch (error) {
                console.error("PDF ç”Ÿæˆå¤±æ•—:", error);
                alert("æŠ±æ­‰ï¼ŒPDF æª”æ¡ˆç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
            } finally {
                // 5. æ¸…ç†æˆ°å ´ï¼šç„¡è«–æˆåŠŸæˆ–å¤±æ•—ï¼Œéƒ½æ¢å¾©é é¢åŸæ¨£
                passportContainer.classList.remove('pdf-export-mode');
                targetPane.style.display = ''; // ç§»é™¤å…§è¯æ¨£å¼ï¼Œè®“ CSS æ¥ç®¡

                // æ¢å¾©æŒ‰éˆ•
                buttonElement.disabled = false;
                buttonElement.innerText = `ğŸ“„ ä¸‹è¼‰ã€Œ${fileNamePrefix}ã€ç‚º PDF`;
            }
        }

        // ç‚ºæ‰€æœ‰å…·æœ‰ .download-pdf-btn class çš„æŒ‰éˆ•ç¶å®šé»æ“Šäº‹ä»¶
        document.querySelectorAll('.download-pdf-btn').forEach(button => {
            button.addEventListener('click', () => handlePdfDownload(button));
        });
    </script>

</body>
</html>
